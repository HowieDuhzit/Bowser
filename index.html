<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bowser AI - Your Discord AI Companion</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script>
        // Load environment variables
        const loadEnv = async () => {
            try {
                const response = await fetch('/.env');
                const text = await response.text();
                const env = {};
                
                text.split('\n').forEach(line => {
                    const [key, value] = line.split('=');
                    if (key && value) {
                        env[key.trim()] = value.trim();
                    }
                });
                
                return env;
            } catch (error) {
                console.error('Error loading environment variables:', error);
                return {};
            }
        };
    </script>
</head>
<body>
    <header>
        <nav>
            <div class="logo-container">
                <img src="bowser-icon.png" alt="Bowser AI Icon">
                <div class="logo">Bowser AI</div>
            </div>
            <div class="nav-controls">
                <button id="theme-toggle" class="theme-toggle">
                    <svg class="sun-icon" viewBox="0 0 24 24"><path d="M12 17.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zm0 1.5a7 7 0 1 1 0-14 7 7 0 0 1 0 14zm0-16a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0V4a1 1 0 0 1 1-1zm0 15a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0v-2a1 1 0 0 1 1-1z"/></svg>
                    <svg class="moon-icon" viewBox="0 0 24 24"><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/></svg>
                </button>
                <div class="wallet-dropdown">
                    <button id="wallet-connect" class="wallet-connect">Connect Wallet</button>
                    <div id="wallet-dropdown" class="dropdown-content">
                        <div id="token-balance" class="token-balance">Loading balance...</div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="hero">
            <img src="bowser-icon.png" alt="Bowser AI Mascot" class="mascot-image">
            <h1>Meet Bowser AI</h1>
            <p>Your intelligent Discord companion for voice and text interactions</p>
            <div class="button-group">
                <a href="https://discord.com/oauth2/authorize?client_id=1128696854696173719&permissions=515433295168&scope=bot%20applications.commands" class="cta-button">Add to Discord</a>
                <a href="https://t.me/DragonWifBeard" class="cta-button telegram">Join Telegram</a>
            </div>
        </section>

        <section id="features" class="features">
            <h2>Features</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>Voice Interaction</h3>
                    <p>Talk with Bowser naturally in voice channels</p>
                </div>
                <div class="feature-card">
                    <h3>Text Chat</h3>
                    <p>Engage in text conversations across channels</p>
                </div>
                <div class="feature-card">
                    <h3>AI-Powered</h3>
                    <p>Advanced AI capabilities for natural conversations</p>
                </div>
                <div class="feature-card">
                    <h3>24/7 Available</h3>
                    <p>Always ready to help and interact</p>
                </div>
            </div>
        </section>

        <section id="about" class="about">
            <h2>About Bowser AI</h2>
            <p>Bowser is an advanced AI agent designed to enhance your Discord server experience. Whether through voice or text, Bowser can engage in natural conversations, assist with tasks, and make your server more interactive and fun.</p>
        </section>

        <section id="livestream" class="livestream">
            <h2>Live Stream</h2>
            <div class="twitter-embed-container">
                <blockquote class="twitter-tweet" data-media-max-width="560">
                    <p lang="zxx" dir="ltr">
                        <a href="https://t.co/qg5w85uOPb">https://t.co/qg5w85uOPb</a>
                    </p>
                    &mdash; Bowser (@DragonWifBeard) 
                    <a href="https://twitter.com/DragonWifBeard/status/1868519360609816885?ref_src=twsrc%5Etfw">
                        December 16, 2024
                    </a>
                </blockquote>
                <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            </div>
        </section>

        <section id="token" class="token">
            <h2>DragonWifBeard Token</h2>
            <div class="chart-container">
                <style>
                    #dexscreener-embed{
                        position:relative;
                        width:100%;
                        padding-bottom:65%;
                        max-width: 1200px;
                        margin: 0 auto;
                    }
                    @media(min-width:1400px){
                        #dexscreener-embed{
                            padding-bottom:45%;
                        }
                    }
                    #dexscreener-embed iframe{
                        position:absolute;
                        width:100%;
                        height:100%;
                        top:0;
                        left:0;
                        border:0;
                        border-radius: 10px;
                    }
                    .chart-container {
                        padding: 0 2rem;
                    }
                </style>
                <div id="dexscreener-embed">
                    <iframe src="https://dexscreener.com/solana/8YQxJShh7qNeGa9o1twwjehREYdhztdr1U6Q9ukvCQBZ?embed=1&loadChartSettings=0&tabs=0&chartLeftToolbar=0&chartTheme=dark&theme=dark&chartStyle=0&chartType=usd&interval=15"></iframe>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-links">
                <a href="tos.html">Terms of Service</a>
                <a href="privacy.html">Privacy Policy</a>
            </div>
            <p>&copy; 2024 Bowser AI. All rights reserved.</p>
        </div>
    </footer>
    <audio id="background-music" loop autoplay style="display: none;">
        <source src="DFTB.mp3" type="audio/mpeg">
    </audio>
    <script>
        // Set initial theme
        document.documentElement.setAttribute('data-theme', 'dark');
        
        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });
        
        // Check for saved theme preference
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        // Start playing background music (needed for autoplay policies)
        document.addEventListener('click', function() {
            const audio = document.getElementById('background-music');
            audio.play();
        }, { once: true });
        
        // Auto-pause audio when user leaves the page
        document.addEventListener('visibilitychange', function() {
            const audio = document.getElementById('background-music');
            if (document.hidden) {
                audio.pause();
            }
        });
        
        // Phantom wallet integration
        let walletAddress = null;
        const TOKEN_ADDRESS = '3WcuajU3xSKF1xyg8CB3XNsDDkLUnqepXJ8ETqVTpump';
        
        // Use Helius RPC service
        let RPC_ENDPOINT = '';
        let isEndpointReady = false;
        
        // Initialize RPC endpoint with API key
        (async () => {
            try {
                const env = await loadEnv();
                RPC_ENDPOINT = `https://rpc.helius.xyz/?api-key=${env.HELIUS_API_KEY}`;
                isEndpointReady = true;
                
                // If wallet was previously connected, update the balance
                const wasConnected = localStorage.getItem('walletConnected') === 'true';
                if (wasConnected && walletAddress) {
                    updateTokenBalance();
                }
            } catch (error) {
                console.error('Error initializing RPC endpoint:', error);
            }
        })();
        
        async function getTokenBalance(walletAddress) {
            if (!isEndpointReady) {
                console.log('Waiting for RPC endpoint to initialize...');
                return 'Loading...';
            }
            
            try {
                const connection = new solanaWeb3.Connection(RPC_ENDPOINT);
                const publicKey = new solanaWeb3.PublicKey(walletAddress);
                
                // First, get all token accounts
                const response = await fetch(RPC_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 'my-id',
                        method: 'getTokenAccountsByOwner',
                        params: [
                            walletAddress,
                            {
                                mint: TOKEN_ADDRESS
                            },
                            {
                                encoding: 'jsonParsed'
                            }
                        ],
                    }),
                });
                
                const data = await response.json();
                
                if (data.result && data.result.value.length > 0) {
                    const balance = data.result.value[0].account.data.parsed.info.tokenAmount.uiAmount;
                    return balance.toLocaleString();
                }
                
                return '0';
            } catch (error) {
                console.error('Error fetching token balance:', error);
                return 'Error loading balance';
            }
        }
        
        async function updateTokenBalance() {
            if (!walletAddress) return;
            
            const balanceElement = document.getElementById('token-balance');
            balanceElement.textContent = 'Loading balance...';
            balanceElement.classList.add('token-balance-loading');
            
            // Wait for endpoint to be ready if necessary
            while (!isEndpointReady) {
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            const balance = await getTokenBalance(walletAddress);
            balanceElement.textContent = `Balance: ${balance} DWB`;
            balanceElement.classList.remove('token-balance-loading');
        }
        
        const connectWallet = async () => {
            try {
                const { solana } = window;
                
                if (!solana?.isPhantom) {
                    alert('Please install Phantom wallet!');
                    window.open('https://phantom.app/', '_blank');
                    return;
                }
                
                const response = await solana.connect();
                walletAddress = response.publicKey.toString();
                const walletButton = document.getElementById('wallet-connect');
                walletButton.textContent = `${walletAddress.slice(0, 4)}...${walletAddress.slice(-4)}`;
                walletButton.classList.add('connected');
                
                // Check if this is a new user
                try {
                    const profileResponse = await fetch(`/api/profile/${walletAddress}`);
                    if (!profileResponse.ok) {
                        // New user - redirect to profile page
                        localStorage.setItem('walletConnected', 'true');
                        localStorage.setItem('walletAddress', walletAddress);
                        window.location.href = 'profile.html';
                        return;
                    }
                } catch (error) {
                    console.error('Error checking profile:', error);
                }
                
                // Existing user - update token balance
                updateTokenBalance();
                
                // Save connection status
                localStorage.setItem('walletConnected', 'true');
                localStorage.setItem('walletAddress', walletAddress);
            } catch (error) {
                console.error(error);
                alert('Failed to connect wallet');
            }
        };
        
        // Toggle dropdown
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('wallet-dropdown');
            const walletButton = document.getElementById('wallet-connect');
            
            if (walletAddress && event.target === walletButton) {
                dropdown.classList.toggle('show');
                if (dropdown.classList.contains('show')) {
                    updateTokenBalance();
                }
            } else if (!event.target.closest('.wallet-dropdown')) {
                dropdown.classList.remove('show');
            }
        });
        
        // Check if wallet was previously connected
        window.addEventListener('load', async () => {
            const wasConnected = localStorage.getItem('walletConnected') === 'true';
            if (wasConnected) {
                const savedAddress = localStorage.getItem('walletAddress');
                if (savedAddress) {
                    walletAddress = savedAddress;
                    const walletButton = document.getElementById('wallet-connect');
                    walletButton.textContent = `${walletAddress.slice(0, 4)}...${walletAddress.slice(-4)}`;
                    walletButton.classList.add('connected');
                }
            }
        });
        
        // Add wallet connect button listener
        document.getElementById('wallet-connect').addEventListener('click', connectWallet);
        
        // Handle wallet change events
        if (window.solana) {
            window.solana.on('disconnect', () => {
                walletAddress = null;
                const walletButton = document.getElementById('wallet-connect');
                walletButton.textContent = 'Connect Wallet';
                walletButton.classList.remove('connected');
                localStorage.removeItem('walletConnected');
                localStorage.removeItem('walletAddress');
            });
            
            window.solana.on('accountChanged', async (publicKey) => {
                if (publicKey) {
                    walletAddress = publicKey.toString();
                    const walletButton = document.getElementById('wallet-connect');
                    walletButton.textContent = `${walletAddress.slice(0, 4)}...${walletAddress.slice(-4)}`;
                    localStorage.setItem('walletAddress', walletAddress);
                }
            });
        }
    </script>
</body>
</html> 